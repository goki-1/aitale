data = {
  title : "fighty fighty",
  "visualStyle": "realistic",
  "panels": [{
    
        "type": "character dialogues",
        "content": [
          {
            "character": "Narrator",
            "dialogue": "In a world where legends and heroes collide, Goku and Aquaman set out on an epic journey to meet the notorious pirates of the Caribbean.",
            "tone": "neutral"
          },
          {
            "character": "Goku",
            "dialogue": "This is going to be an exciting adventure, Aquaman!",
            "tone": "happy"
          },
          
          {
            "character": "Hero2",
            "dialogue": "Indeed, Goku. The seas hold many secrets and dangers.",
            "tone": "neutral"
          },
           {
            "character": "Villain1",
            "dialogue": "Indeed, Goku. The seas hold many secrets and dangers.",
            "tone": "neutral"
          }
        ],
        "fight_in_this_panel": "no fight",
        "location": "Coastal town with bustling markets and ships",
        "background_sound": "people bustling",
        "background_music": "adventure",
        "genId": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/6685b6d9-ed89-4641-b6ce-4ee85f2f2a30/Default_Approaching_a_fogcovered_island_with_hidden_coves_gro_0.",
        "camera_movement": "down"
      },
      {
        "type": "character dialogues",
        "content": [
         
          {
            "character": "Aquaman",
            "dialogue": "The ocean beckons us, Goku. Let's sail towards the unknown!",
            "tone": "happy"
          },
          {
            "character": "Goku",
            "dialogue": "I can sense the thrill of the upcoming encounter!",
            "tone": "happy"
          }
        ],
        "fight_in_this_panel": "no fight",
        "location": "Onboard a majestic sailing ship",
        "background_sound": "ocean/river waves",
        "background_music": "adventure",
        "genId": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/a31d8095-5785-4a9c-aca4-03db2a46b3af/Default_on_the_deck_of_a_ship_ocean_sea_waves_0.jpg",
        "camera_movement": "zoom in"
      },
      
      {
        "type": "character dialogues",
        "content": [
          {
            "character": "Narrator",
            "dialogue": "As they approach the mysterious island rumored to be the pirates' hideout, a sense of anticipation fills the air.",
            "tone": "neutral"
          },
          {
            "character": "Goku",
            "dialogue": "The thrill of the unknown awaits us, Aquaman. Are you ready?",
            "tone": "happy"
          },
          {
            "character": "Aquaman",
            "dialogue": "I am prepared, Goku. Our courage will guide us through any challenge.",
            "tone": "happy"
          }
        ],
        "fight_in_this_panel": "no fight",
        "location": "Approaching a fog-covered island with hidden coves",
        importantObject:"stunning view of sunset",
        "background_sound": "birds chirping",
        "background_music": "adventure",
        "genId": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/a31d8095-5785-4a9c-aca4-03db2a46b3af/Default_on_the_deck_of_a_ship_ocean_sea_waves_0.jpg",
        objectGenId: "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/1684f3fd-6931-4de8-ae75-07d1f0b77c9d/Default_Sandy_shore_with_hidden_caves_and_pirate_flags_0.jpg",
        "camera_movement": "down"
      },
      {
        "type": "character dialogues",
        "content": [
          {
            "character": "Narrator",
            "dialogue": "As Goku and Aquaman step onto the sandy shore, shadows of the pirate crew emerge from the mist, ready to confront the unexpected visitors.",
            "tone": "surprised"
          },
          {
            "character": "Goku",
            "dialogue": "The pirates have come to greet us, Aquaman. It seems our reputation precedes us!",
            "tone": "surprised"
          },
          {
            "character": "Aquaman",
            "dialogue": "Let's show them the strength of our alliance, Goku. The real adventure begins now!",
            "tone": "surprised"
          }
        ],
        "fight_in_this_panel": "fight",
        "location": "Sandy shore with hidden caves and pirate flags",
        "background_sound": "ocean/river waves",
        "background_music": "adventure",
        "genId": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/1684f3fd-6931-4de8-ae75-07d1f0b77c9d/Default_Sandy_shore_with_hidden_caves_and_pirate_flags_0.jpg",
        "camera_movement": "zoom out"
      }
  ],
  "characters": [
      {
        "character": "Goku",
        "character_type": "comic/movie character who walks on two legs",
        "sound": "male",
        "size": "normal 5'10 feet",
        "role": "hero/good",
        "description": "Goku, Son Goku, Orange outfit with a blue sash, black wristbands and boots, spiky black hair, and a tail",
        "poseImageIds": {
          "front pose standing still": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/bdcfda9b-4d11-4edb-9df7-1cab92e089eb/variations/Default_goku_0_bdcfda9b-4d11-4edb-9df7-1cab92e089eb_0.pn",
          "side pose standing still(left facing)": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/4a3c7940-4daa-4c2f-a588-62b7fab01a18/variations/Default_Goku_0_4a3c7940-4daa-4c2f-a588-62b7fab01a18_0.png",
          "side pose standing still(right facing)": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/4a3c7940-4daa-4c2f-a588-62b7fab01a18/variations/Default_Goku_0_4a3c7940-4daa-4c2f-a588-62b7fab01a18_0.png",
          "side pose standing still(left tilted)": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/00526681-34f1-4f2e-8f34-29d092c16cde/variations/Default_Goku_0_00526681-34f1-4f2e-8f34-29d092c16cde_0.png",
          "side pose standing still(right tilted)": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/00526681-34f1-4f2e-8f34-29d092c16cde/variations/Default_Goku_0_00526681-34f1-4f2e-8f34-29d092c16cde_0.png",
          "standing back pose": "de7968c9-737c-4fb6-974e-3dd0b83e6a46"
        }
      },
      {
        "character": "Aquaman",
        "character_type": "comic/movie character who walks on two legs",
        "sound": "male",
        "size": "normal 5'10 feet",
        "role": "hero/good",
        "description": "Aquaman, Arthur Curry, Golden and green scale armor with a trident",
        "poseImageIds": {
          "front pose standing still": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/8498bf75-fe3c-4e79-98cc-16fab79a6fc6/variations/Default_spiderman_0_8498bf75-fe3c-4e79-98cc-16fab79a6fc6_0.png",
          "side pose standing still(left facing)": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/34fcbcc6-9d71-4e04-945a-c9ea0be1fcbf/variations/Default_spiderman_0_34fcbcc6-9d71-4e04-945a-c9ea0be1fcbf_0.png",
          "side pose standing still(right facing)": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/34fcbcc6-9d71-4e04-945a-c9ea0be1fcbf/variations/Default_spiderman_0_34fcbcc6-9d71-4e04-945a-c9ea0be1fcbf_0.png",
          "side pose standing still(left tilted)": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/b6fce0c9-94d2-46f2-9b8d-9b3e2915e7ca/variations/Default_spiderman_0_b6fce0c9-94d2-46f2-9b8d-9b3e2915e7ca_0.png",
          "side pose standing still(right tilted)": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/b6fce0c9-94d2-46f2-9b8d-9b3e2915e7ca/variations/Default_spiderman_0_b6fce0c9-94d2-46f2-9b8d-9b3e2915e7ca_0.png",
          "standing back pose": "de7968c9-737c-4fb6-974e-3dd0b83e6a46"
        }
      },
      {
      "character": "Hero2",
      "character_type": "comic/movie character who walks on two legs",
      "sound": "female",
      "size": "normal 5'7 feet",
      "role": "normal",
      "description": "Hero2, a skilled archer with unmatched accuracy, wears a green and brown leather outfit, equipped with a quiver of arrows.",
      "poseImageIds": {
        "front pose standing still": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/b3d11e2a-fd23-4392-8ce8-a1c3148ebe32/variations/Default_man_standing_still_looking_at_camera_abs_full_body_le_0_b3d11e2a-fd23-4392-8ce8-a1c3148ebe32_0.png",
          "side pose standing still(left facing)": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/8bce9e52-3b72-4fa9-b054-79f3255c6c42/variations/Default_side_pose_of_man_full_body_face_0_8bce9e52-3b72-4fa9-b054-79f3255c6c42_0.png",
          "side pose standing still(right facing)": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/8bce9e52-3b72-4fa9-b054-79f3255c6c42/variations/Default_side_pose_of_man_full_body_face_0_8bce9e52-3b72-4fa9-b054-79f3255c6c42_0.png",
          "side pose standing still(left tilted)": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/60c574a6-8092-4bad-84b2-261e93483425/variations/Default_man_0_60c574a6-8092-4bad-84b2-261e93483425_0.png",
          "side pose standing still(right tilted)": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/60c574a6-8092-4bad-84b2-261e93483425/variations/Default_man_0_60c574a6-8092-4bad-84b2-261e93483425_0.png",
          "standing back pose": "de7968c9-737c-4fb6-974e-3dd0b83e6a46"
      }
    },
    {
      "character": "Villain1",
      "character_type": "comic/movie character who walks on two legs",
      "sound": "male",
      "size": "tall 6'5 feet",
      "role": "villain",
      "description": "Villain1, the fearsome leader of the pirate crew, dons a black and red coat, brandishing a cursed sword.",
      "poseImageIds": {
        "front pose standing still": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/dc9f005d-fc78-4884-b778-d2c45d2c0be0/variations/Default_ultron_0_dc9f005d-fc78-4884-b778-d2c45d2c0be0_0.png",
          "side pose standing still(left facing)": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/ea6d05f5-2e53-4486-9f2a-3817eaa0aab4/variations/Default_Ultron_0_ea6d05f5-2e53-4486-9f2a-3817eaa0aab4_0.png",
          "side pose standing still(right facing)": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/ea6d05f5-2e53-4486-9f2a-3817eaa0aab4/variations/Default_Ultron_0_ea6d05f5-2e53-4486-9f2a-3817eaa0aab4_0.png",
          "side pose standing still(left tilted)": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/a17fd06c-5227-40e1-a44f-bc3f7dea580d/Default_Ultron_0.jpg",
          "side pose standing still(right tilted)": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/a17fd06c-5227-40e1-a44f-bc3f7dea580d/Default_Ultron_0.jpg",
          "standing back pose": "de7968c9-737c-4fb6-974e-3dd0b83e6a46"
      }
    },
    {
      "character": "Villain1",
      "character_type": "comic/movie character who walks on two legs",
      "sound": "male",
      "size": "tall 6'5 feet",
      "role": "villain",
      "description": "Villain1, the fearsome leader of the pirate crew, dons a black and red coat, brandishing a cursed sword.",
      "poseImageIds": {
        "front pose standing still": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/2034c35b-7b55-4195-8003-ef087c395092/variations/Default_optimus_prime_0_2034c35b-7b55-4195-8003-ef087c395092_0.png",
          "side pose standing still(left facing)": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/9cd8a92e-5bf7-48ab-abff-f4b63c2065cc/variations/Default_Optimus_Prime_0_9cd8a92e-5bf7-48ab-abff-f4b63c2065cc_0.png",
          "side pose standing still(right facing)": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/9cd8a92e-5bf7-48ab-abff-f4b63c2065cc/variations/Default_Optimus_Prime_0_9cd8a92e-5bf7-48ab-abff-f4b63c2065cc_0.png",
          "side pose standing still(left tilted)": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/8fdce8fe-6cd6-4d00-bb8b-ab62746e258c/variations/Default_optimus_prime_0_8fdce8fe-6cd6-4d00-bb8b-ab62746e258c_0.png",
          "side pose standing still(right tilted)": "https://cdn.leonardo.ai/users/ad1fa781-4f92-4642-a3d3-a5bf85eec6e3/generations/8fdce8fe-6cd6-4d00-bb8b-ab62746e258c/variations/Default_optimus_prime_0_8fdce8fe-6cd6-4d00-bb8b-ab62746e258c_0.png",
          "standing back pose": "de7968c9-737c-4fb6-974e-3dd0b83e6a46"
      }
    },
    ],
}

const createCharacterDialogueSinglePanel = (parentPanel, character, index, initialAppearances) => {
  const isInitialAppearance = !initialAppearances.includes(character.character);

  const dialogues = character.dialogue.split(/[.,]/).filter(dialogue => dialogue.trim() !== "" 
  && dialogue.trim() !== "." && dialogue.trim() !== ",");

  const panels = dialogues.map((dialogue, i) => {
    // Update the condition to check if it's the narrator and isFirstNarratorPanel
    if (character.character === 'Narrator') {

      if (isInitialAppearance) {
        initialAppearances.push(character.character);
      }
        const cameraMovement = isInitialAppearance
          ? { camera_movement: 'left to right' }
          : { camera_movement: 'right to left' };

        return {
          type: 'narrator',
          content: [{
            character: character.character,
            dialogue: dialogue.trim(), // Remove leading/trailing whitespaces
            tone: character.tone,
          }],// Do not add any character for the first narrator panel
          background_music: parentPanel.background_music,
          index: index + i,
          genId: parentPanel.genId,
          ...cameraMovement,
        };
    } 
    const cameraMovement = isInitialAppearance && dialogue.length > 30
    ? { camera_movement: 'zoom in and up' }
    : { camera_movement: dialogue.length > 10 ? 'close up' : 'some random zoom in' };

    return {
      type: 'character dialogues single',
      content: [{
        character: character.character,
        dialogue: dialogue.trim(), // Remove leading/trailing whitespaces
        tone: character.tone,
      }],
      background_music: parentPanel.background_music,
      index: index + i,
      genId: parentPanel.genId,
      ...cameraMovement,
    };
  });

  // Update initialAppearances if it's the initial appearance
  if (isInitialAppearance) {
    initialAppearances.push(character.character);
  }

  return panels;
};

// Main function to transform the original JSON
const transformJson = (originalJson) => {
  let currentIndex = 0;
  const charactersWithInitialAppearance = [];

  const transformedJson = {
    ...originalJson,
    panels: originalJson.panels.flatMap((panel, panelIndex) => {
      const modifiedPanel = {
        ...panel,
        index: currentIndex++,
      };

      const newPanels = [modifiedPanel];

      if (panel.type === 'character dialogues') {
        panel.content.forEach((character, characterIndex) => {
          const characterDialogueSinglePanels = createCharacterDialogueSinglePanel(
            modifiedPanel,
            character,
            currentIndex,
            charactersWithInitialAppearance
          );

          // Concatenate new panels to the result
          newPanels.push(...characterDialogueSinglePanels);

          currentIndex += characterDialogueSinglePanels.length;
        });
      }

      return newPanels;
    }),
  };

  return transformedJson;
};

 const addPoseImageIdsToCharacters = (panels, characters) => {
  // Create a map for quick access to character pose IDs
  const characterPoses = characters.reduce((acc, character) => {
    acc[character.character] = character.poseImageIds["front pose standing still"];
    return acc;
  }, {});

  // Iterate over each panel and each character to add the poseImageId
  return panels.map(panel => {
    if (panel.type === 'character dialogues single') {
      panel.content = panel.content.map(content => {
        if (content.character !== 'Narrator') {
          // Add poseImageId to the character
          return {
            ...content,
            poseImageId: characterPoses[content.character],
            character_relative_location_in_panel:"center",
          };
        }
        return content;
      });
    }
    return panel;
  });
};
//data = transformJson(data);
function modifyPanelsForNarratorAndDialogueLength(panels) {
  let lastCharacterPanel = null;
  let b = 0;
  const modifiedPanels = []; // Use a new array to store the modified panels
  let ind = 0;
  panels.forEach(panel => {
    if (panel.type === 'character dialogues') b = -1;
    else b += 1;

    // Directly add the current panel to the modifiedPanels array
    modifiedPanels.push(panel);

    // For narrator panels, add characters from the last character dialogue panel
    if (panel.type === 'narrator' && lastCharacterPanel && b > 0) {
      panel.content.push(...lastCharacterPanel.content.map(character => ({
        ...character,
        dialogue: "" // Copy characters without dialogue
      })));
    }

    // For single dialogue panels with long dialogues, add characters from the last character dialogue panel
    if (panel.type === 'character dialogues single') {
      panel.content.forEach(content => {
        if (content.dialogue.length > 40 && lastCharacterPanel) {
          panel.content.push(...lastCharacterPanel.content.filter(c => c.character !== content.character).map(character => ({
            ...character,
            dialogue: "" // Copy characters without dialogue
          })));
        }
      });
    }

    // Keep track of the last character dialogue panel
    if (panel.type === 'character dialogues' || panel.type === 'character dialogues single') {
      lastCharacterPanel = panel;
    }

    // Check for objectGenId and create an additional "object" panel
    if (panel.objectGenId) {
      const objectPanel = {
        type: 'object',
        content: [],
        objectGenId: panel.objectGenId,
        camera_movement: "zoom in",
        index: ind, // Increment the index slightly to insert after the current panel
      };
      modifiedPanels.push(objectPanel); // Add the new object panel to the modifiedPanels array
    }
    ind ++;
  });

  return modifiedPanels; // Return the array with the added object panels
}
const addPoseImageIdsToCharacter = (panels, characters) => {
  // Create a map for quick access to character pose IDs
  const characterInfo = characters.reduce((acc, character) => {
    acc[character.character] = {
      role: character.role,
      poseImageIds: character.poseImageIds,
    };
    return acc;
  }, {});

  
 const allCharactersAreGoodOrNormal = (contents) => 
    contents.every(content => 
      characterInfo[content.character].role === 'hero/good' || 
      characterInfo[content.character].role === 'normal'
    );
  // Helper function to determine if all characters have the same role
  const allCharactersHaveRole = (contents, role) => 
    contents.every(content => characterInfo[content.character].role === role);

  // Iterate over each panel and update character locations and poses
  return panels.map(panel => {
    if (panel.type === 'character dialogues single' || panel.type === 'narrator') {
      let contents = panel.content.filter(content => content.character !== 'Narrator');


      if (contents.length === 2 && (allCharactersAreGoodOrNormal(contents)|| allCharactersHaveRole(contents, 'villain'))) {
        contents = contents.map((content, index) => ({
          ...content,
          character_relative_location_in_panel: index === 0 ? 'left' : 'right',
          poseImageId: index === 0 ? 
            characterInfo[content.character].poseImageIds['side pose standing still(right facing)'] :
            characterInfo[content.character].poseImageIds['side pose standing still(left facing)'],
        }));
      } else if ((contents.length === 3 && (allCharactersAreGoodOrNormal(contents) || allCharactersHaveRole(contents, 'villain')))) {
        contents = contents.map((content, index) => ({
          ...content,
          character_relative_location_in_panel: ['left', 'center', 'right'][index],
          poseImageId: [
            characterInfo[content.character].poseImageIds['side pose standing still(right tilted)'],
            characterInfo[content.character].poseImageIds['front pose standing still'],
            characterInfo[content.character].poseImageIds['side pose standing still(left tilted)'],
          ][index],
        }));
      } else if (contents.length > 3 && (allCharactersAreGoodOrNormal(contents) || allCharactersHaveRole(contents, 'villain'))) {
        contents = contents.map((content, index) => ({
          ...content,
          character_relative_location_in_panel: index < 3 ? ['left', 'center', 'right'][index] : (index % 2 === 0 ? 'right' : 'left'),
          poseImageId: characterInfo[content.character].poseImageIds['front pose standing still'],
        }));
      }
      else{
         contents = contents.map((content, index) => ({
          ...content,
          character_relative_location_in_panel: index < 3 ? ['left', 'center', 'right'][index] : (index % 2 === 0 ? 'right' : 'left'),
          poseImageId: characterInfo[content.character].poseImageIds['front pose standing still'],
        }));
      }

      // Replace the content with the updated character information
      panel.content = [
        ...panel.content.filter(content => content.character === 'Narrator'), // Keep the narrator as is
        ...contents,
      ];
    }
    return panel;
  });
};

const adjustDialogueBasedOnMajorityRole = (panels, characters) => {
  // First, create a mapping of characters to their roles for quick lookup.
   const characterRoles = characters.reduce((acc, character) => {
    // Treat 'normal' characters as 'hero/good'
    acc[character.character] = character.role === 'normal' ? 'hero/good' : character.role;
    return acc;
  }, {});

  // Helper function to count roles in a panel
  const countRolesInPanel = (panelContent) => {
    return panelContent.reduce((acc, content) => {
      const role = characterRoles[content.character];
      if (role) { // Skip if character is 'Narrator'
        acc[role] = (acc[role] || 0) + 1;
      }
      return acc;
    }, {});
  };

  // Process each panel
  return panels.map(panel => {
    if (panel.type === 'narrator' || panel.type === 'character dialogues single') {
      const roleCounts = countRolesInPanel(panel.content);
      const majorityRole = roleCounts['hero/good'] >= (roleCounts['villain'] || 0) ? 'hero/good' : 'villain';

      // Filter out dialogues for characters of the minority role
      panel.content = panel.content.filter(content => {
        // Keep the dialogue if the character is a narrator or belongs to the majority role
        return content.character === 'Narrator' || characterRoles[content.character] === majorityRole;
      });
    }
    return panel;
  });
};




// Extend transformJson to include modifyPanelsForNarratorAndDialogueLength processing
const transformJsonExtended = (originalJson) => {
  const transformedJson = transformJson(originalJson); // Use the existing transformation logic

  // Modify panels as per the new requirements
  transformedJson.panels = modifyPanelsForNarratorAndDialogueLength(transformedJson.panels);

  return transformedJson;
};

// Assuming 'data' is the original JSON object you provided
//const transformedData = transformJsonExtended(data);
const transformJsonFullyExtended = (originalJson) => {
  let transformedJson = transformJsonExtended(originalJson); // Use the existing extended transformation logic

  // Add poseImageIds to the characters
  transformedJson.panels = addPoseImageIdsToCharacters(transformedJson.panels, originalJson.characters);
 
  transformedJson.panels = addPoseImageIdsToCharacter(transformedJson.panels, originalJson.characters);
  transformedJson.panels = adjustDialogueBasedOnMajorityRole(transformedJson.panels, originalJson.characters);
  
  return transformedJson;
};

// Assuming 'data' is the original JSON object you provided
const fullyTransformedData = transformJsonFullyExtended(data);
console.log(JSON.stringify(fullyTransformedData, null, 2));
